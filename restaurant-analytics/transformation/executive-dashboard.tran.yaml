type: "transformation"
version: "1.0"
pipeline:
  components:
    Customer Lifetime Value Data:
      type: "table-input"
      parameters:
        componentName: "Customer Lifetime Value Data"
        database: "[Environment Default]"
        schema: "[Environment Default]"
        targetTable: "CLV"
        columnNames:
        - "customer_id"
        - "customer_name"
        - "sum_total_price"
      postProcessing:
        updateOutputMessage: "üí∞ Loading Customer Lifetime Value analytics: Extracting\
          \ top customer segments and spending patterns for executive revenue strategy"
        updateScalarVariables:
    Average Order Value Data:
      type: "table-input"
      parameters:
        componentName: "Average Order Value Data"
        database: "[Environment Default]"
        schema: "[Environment Default]"
        targetTable: "AOV"
        columnNames:
        - "avg_total_price"
      postProcessing:
        updateOutputMessage: "üìà Loading Average Order Value metrics: Retrieving global\
          \ transaction benchmarks for executive performance monitoring"
        updateScalarVariables:
    Top Selling Items Data:
      type: "table-input"
      parameters:
        componentName: "Top Selling Items Data"
        database: "[Environment Default]"
        schema: "[Environment Default]"
        targetTable: "TOP_SELLING"
        columnNames:
        - "item_name"
        - "category"
        - "sum_quantity"
        - "sum_total_price"
      postProcessing:
        updateOutputMessage: "üçî Loading menu performance data: Extracting top-selling\
          \ items and category revenue for strategic product planning"
        updateScalarVariables:
    Data Quality Status:
      type: "table-input"
      parameters:
        componentName: "Data Quality Status"
        database: "[Environment Default]"
        schema: "[Environment Default]"
        targetTable: "DATA_QUALITY_REPORT"
        columnNames:
        - "data_quality_flag"
        - "count_order_id"
      postProcessing:
        updateOutputMessage: "üîç Loading data quality metrics: Retrieving validation\
          \ results for executive data governance reporting"
        updateScalarVariables:
    Executive KPI Summary:
      type: "calculator"
      sources:
      - "Average Order Value Data"
      parameters:
        componentName: "Executive KPI Summary"
        includeInputColumns: "Yes"
        calculations:
        - - "'Restaurant Performance Dashboard'"
          - "dashboard_title"
        - - "CURRENT_DATE()"
          - "report_date"
        - - |
            CASE 
              WHEN "avg_total_price" IS NULL THEN 'Data Error: AOV Missing'
              WHEN "avg_total_price" <= 0 THEN 'Data Issue: Invalid AOV'
              ELSE CONCAT('AOV: $', ROUND("avg_total_price", 2))
            END
          - "aov_status"
        - - "TO_VARCHAR(CURRENT_TIMESTAMP(), 'YYYY-MM-DD HH24:MI:SS')"
          - "last_updated"
        - - |
            CASE
              WHEN "avg_total_price" > 100 THEN 'EXCELLENT'
              WHEN "avg_total_price" > 75 THEN 'GOOD' 
              WHEN "avg_total_price" > 50 THEN 'AVERAGE'
              ELSE 'NEEDS_IMPROVEMENT'
            END
          - "performance_rating"
    Customer Lifetime Value Summary:
      type: "aggregate"
      sources:
      - "Customer Lifetime Value Data"
      parameters:
        componentName: "Customer Lifetime Value Summary"
        groupings:
        aggregations:
        - - "sum_total_price"
          - "Sum"
        - - "customer_id"
          - "Count"
        - - "sum_total_price"
          - "Average"
        - - "sum_total_price"
          - "Max"
        groupingType: "Group By"
    Category Performance Summary:
      type: "aggregate"
      sources:
      - "Top Selling Items Data"
      parameters:
        componentName: "Category Performance Summary"
        groupings:
        - "category"
        aggregations:
        - - "sum_total_price"
          - "Sum"
        - - "sum_quantity"
          - "Sum"
        - - "item_name"
          - "Count"
        groupingType: "Group By"
    Executive Summary Output:
      type: "rewrite-table"
      sources:
      - "Executive KPI Summary"
      parameters:
        componentName: "Executive Summary Output"
        warehouse: "[Environment Default]"
        database: "[Environment Default]"
        schema: "[Environment Default]"
        targetTable: "EXEC_SUMMARY"
        orderBy:
      postProcessing:
        updateOutputMessage: "üìä Executive summary dashboard ready - Real-time KPIs\
          \ operational"
        updateScalarVariables:
    Customer Lifetime Value Data Output:
      type: "rewrite-table"
      sources:
      - "Customer Lifetime Value Summary"
      parameters:
        componentName: "Customer Lifetime Value Data Output"
        warehouse: "[Environment Default]"
        database: "[Environment Default]"
        schema: "[Environment Default]"
        targetTable: "EXEC_CLV_DATA"
        orderBy:
      postProcessing:
        updateOutputMessage: "üí∞ Customer Lifetime Value executive summary ready"
        updateScalarVariables:
    Category Dashboard Output:
      type: "rewrite-table"
      sources:
      - "Category Performance Summary"
      parameters:
        componentName: "Category Dashboard Output"
        warehouse: "[Environment Default]"
        database: "[Environment Default]"
        schema: "[Environment Default]"
        targetTable: "EXEC_CATEGORY_DASHBOARD"
        orderBy:
        - - "sum_sum_total_price"
          - "DESCENDING"
      postProcessing:
        updateOutputMessage: "üìà Category performance dashboard ready - Strategic\
          \ insights available"
        updateScalarVariables:
    Executive Quality Report:
      type: "calculator"
      sources:
      - "Data Quality Status"
      parameters:
        componentName: "Executive Quality Report"
        includeInputColumns: "Yes"
        calculations:
        - - "'Data Quality Executive Summary'"
          - "report_title"
        - - "CURRENT_TIMESTAMP()"
          - "generated_timestamp"
        - - |
            CASE
              WHEN "count_order_id" > 10000 THEN 'HIGH_VOLUME'
              WHEN "count_order_id" > 1000 THEN 'MEDIUM_VOLUME'
              ELSE 'LOW_VOLUME'
            END
          - "volume_classification"
    Executive Quality Dashboard:
      type: "rewrite-table"
      sources:
      - "Executive Quality Report"
      parameters:
        componentName: "Executive Quality Dashboard"
        warehouse: "[Environment Default]"
        database: "[Environment Default]"
        schema: "[Environment Default]"
        targetTable: "EXEC_QUALITY_DASHBOARD"
        orderBy:
      postProcessing:
        updateOutputMessage: "üîç Executive quality dashboard ready - Data governance\
          \ metrics available for leadership"
        updateScalarVariables:
design:
  components:
    Customer Lifetime Value Data:
      position:
        x: 0
        "y": 0
      tempMetlId: 1
    Average Order Value Data:
      position:
        x: 0
        "y": 100
      tempMetlId: 2
    Top Selling Items Data:
      position:
        x: 0
        "y": 200
      tempMetlId: 3
    Data Quality Status:
      position:
        x: 0
        "y": 300
      tempMetlId: 4
    Executive KPI Summary:
      position:
        x: 300
        "y": 100
      tempMetlId: 5
    Customer Lifetime Value Summary:
      position:
        x: 300
        "y": 0
      tempMetlId: 6
    Category Performance Summary:
      position:
        x: 300
        "y": 200
      tempMetlId: 7
    Executive Summary Output:
      position:
        x: 600
        "y": 100
      tempMetlId: 8
    Customer Lifetime Value Data Output:
      position:
        x: 600
        "y": 0
      tempMetlId: 9
    Category Dashboard Output:
      position:
        x: 600
        "y": 200
      tempMetlId: 10
    Executive Quality Report:
      position:
        x: 320
        "y": 300
      tempMetlId: 11
    Executive Quality Dashboard:
      position:
        x: 600
        "y": 300
      tempMetlId: 12
  notes:
    "1":
      position:
        x: -331
        "y": -50
      size:
        height: 430
        width: 280
      theme: "light-blue"
      content: |
        ### **üìä Analytics Data Sources**

        **Executive Input Tables:**
        - üí∞ **CLV**: Customer lifetime value rankings
        - üìà **AOV**: Average order value metrics
        - üçΩÔ∏è **TOP_SELLING**: Menu performance data

        **Data Validation:**
        - Ensures all analytics tables exist
        - Validates data completeness
        - Handles missing data gracefully
    "2":
      position:
        x: 190
        "y": -310
      size:
        height: 785
        width: 280
      theme: "light-green"
      content: "### **üî¨ Executive Processing**\n\n**Summary Calculations:**\n- Customer\
        \ metrics aggregation\n- Category performance rankings  \n- KPI dashboard\
        \ metadata\n\n**Error Handling:**\n- NULL value protection\n- Data quality\
        \ indicators\n- Status validation checks\n"
    "3":
      position:
        x: 690
        "y": -50
      size:
        height: 455
        width: 280
      theme: "green"
      content: |
        ### **üíº C-Suite Dashboards**

        **Executive Outputs:**
        - üìã **EXEC_SUMMARY**: KPI overview
        - üí∞ **EXEC_CLV_DATA**: Customer insights
        - üìà **EXEC_CATEGORY_DASHBOARD**: Performance rankings

        **Business Value:**
        - Real-time strategic metrics
        - Data-driven decision support
        - Executive presentation ready
